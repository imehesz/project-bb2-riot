<settings>
  <div >
    <div title="Toggle Settings">
      <input type="checkbox" checked="{ui.on}" onchange="{toggleOn}"/> 
    </div>
    <div if={ui.on}>
      <h3>Settings</h3>
      <form>
        <label for="fromBook">From Book</label>
        <select id="fromBook" onChange="{fromBookChanged}">
          <option 
            each={languageOptions} 
            value={id} 
            disabled={settingsMixin.toBook==id}
            selected={settingsMixin.fromBook==id}>
              {label}
          </option>
        </select>
        <br />
        <label for="toBook">To Book</label>
        <select id="toBook" onchange="{toBookChanged}">
          <option 
            each={languageOptions} 
            value={id} 
            disabled={settingsMixin.fromBook==id}
            selected={settingsMixin.toBook==id}>
              {label}
          </option>
        </select>
        <br />
        <label for="theme">Theme</label>
        <select id="theme" onchange="{themeChanged}">
          <option each="{theme in themeOptions}" value="{theme}">{ui.capitalize(theme)}</option>
        </select>
        <br />
        <label for="showsecond">Show Second Book</label>
        <input type="checkbox" checked="{settingsMixin.showSecondBook}" onchange="{toggleSecondBook}"/>
      </form>
    </div>
    <hr>
  </div>

  <script>
    var self = this;
    var SETTINGS = typeof BB_SETTINGS != "undefined" ? BB_SETTINGS : {};
    
    self.ui = {
      on: true,
      capitalize: function(str) {
        return str[0].toUpperCase() + str.substr(1,str.length);
      }
    };
    
    this.languageOptions = SETTINGS.languageOptions || [
      {id: "asv", label: "American Standard Version (ASV)"},
      {id: "esv", label: "English Standard Version (ESV)"},
      {id: "nhun", label: "Hungarian (NEW)"},
      {id: "greek", label: "Greek"},
      {id: "moo", label: "Moo"}
    ];
    
    this.themeOptions = SETTINGS.themeOptions || ["light", "dark", "papyrus"];
    
    var defaults = {
      fromBook: "esv",
      toBook: "nhun",
      theme: "light",
      showSecondBook: true
    };
    
    self.settingsMixin = $.extend({}, defaults);
    riot.mixin("settingsMixin", self.settingsMixin);
    
    var oldSettings = JSON.stringify(self.settingsMixin);
    
    self.fromBookChanged = function(el) {
      self.settingsMixin.fromBook = $(el.target).val();
    };
    
    self.toBookChanged = function(el) {
      self.settingsMixin.toBook = $(el.target).val();
    };
    
    self.themeChanged = function(el) {
      self.settingsMixin.theme = $(el.target).val();
    };
    
    self.toggleSecondBook = function(el) {
      self.settingsMixin.showSecondBook = !self.settingsMixin.showSecondBook;
    };
    
    self.toggleOn = function() {
      self.ui.on = !self.ui.on;
      
      if (!self.ui.on && oldSettings != JSON.stringify(self.settingsMixin)) {
        console.log(JSON.parse(oldSettings), self.settingsMixin);
        
        // TODO save it to localstorage
        oldSettings = JSON.stringify(self.settingsMixin);
      }
    };
  </script>
</settings>