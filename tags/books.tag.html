<books>
  <div>
    <div if={showMe}>
      <span if={books.length==0}>loading books ...</span>
      <button each="{book in books}" onclick={setBook}>{getShortHeader(book)}</button>
    </div>
    <chapters></chapters>
  </div>
  <script>
    var self = this;
    
    self.books = [];
    self.showMe = true;
    
    var storage = M.Storage;
    
    M.Events.subscribe("books_loaded", function(books){
      console.log("yup, books loaded...", books);
      self.books = books;
      self.update();
    });
    
    M.Events.subscribe("navTo", function(page){
      self.showMe = false;
      if (page == "books") {
        self.update({
          showMe: true
        })
      }
    });
    
    setBook(e) {
      storage.set("activeBookId", e.item.book.bookId);
      M.Events.publish("navTo", "chapters");
    }
    
    getShortHeader(o) {
      return o.shortHeader ? 
        o.shortHeader : 
        o.headerLong.replace(/\ /g, "").substring(0,5);
    }
    
  </script>
</books>