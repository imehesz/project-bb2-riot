<books-nav>
  <div>
    <book-info></book-info>
    <a if={backTo} href="javascript:void(0);" onclick={goBack}>< BACK</a>
    <settings></settings>
  </div>
  
  <script>
    var self = this;
    var pages = {
      BOOKS: "books",
      CHAPTERS: "chapters",
      LINES: "lines"
    };

    var storage = M.Storage;
    self.backTo = "";
    
    goBack() {
      M.Events.publish("navTo", self.backTo);
    }
    
    var updateBackTo = function(backToStr) {
      self.update({
        backTo: backToStr
      });
    }
    
    var backToBooks = function() {
      updateBackTo(pages.BOOKS);
    }
    
    var backToChapters = function() {
      updateBackTo(pages.CHAPTERS);
    }
    
    var backToNothing = function() {
      updateBackTo("");
    }
    
    M.Events.subscribe("book_changed", backToBooks);
    M.Events.subscribe("chapter_changed", backToChapters);
    
    M.Events.subscribe("navTo", function(page){
      if (page == pages.LINES) {
        backToChapters();
      } else if (page == pages.CHAPTERS) {
        backToBooks();
      } else {
        backToNothing();
      }
    });
  </script>
</books-nav>