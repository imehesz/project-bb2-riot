<chapters>
  <div>
      <div if={chapters.length > 0}>
      CHAPTERS
      <div each={chapter in chapters}>
        <a href="javascript:void(0);" onclick={setChapter}>{chapter}</a>
      </div>
      
      <a href="javascript:void(0);" onclick={backToBooks}>< back</a>
      <lines></lines>
    </div>
  </div>
  <script>
    var self = this;
    
    var reset = function() {
      self.chapters = [];
      self.bookObj = null;
      self.update();
    }
    
    self.backToBooks = function() {
      riot.route("/");
    };
    
    M.Events.subscribe("books_loaded", reset);
    
    M.Events.subscribe('book_changed', function(bookObj) {
      console.log("HEY HUY HAY!");
      self.bookObj = bookObj;
      
      var settings = M.Storage.get("settings");
      
      $.get(M.Storage.get("dataUrl") + "?bookId=" + bookObj.bookId + "&lang=" + settings.fromBook, function(data){
        self.chapters = data.chapters;
  	    self.update();
      });
      
      setChapter(e) {
        riot.route("/" + self.bookObj.bookId + "/" + e.item.chapter);
      }
  	});
  	
  	reset();
  </script>
</chapters>