<web-app>
  <div>
    <books-nav></books-nav>
    WEBAPP
    <books></books>
  </div>
  <script>
    /* global M */
    /* global BB_SETTINGS */
    /* global riot */
    
    var SETTINGS = typeof BB_SETTINGS != "undefined" ? BB_SETTINGS : {};
    M.Storage.set("dataUrl", SETTINGS.dataUrl || "https://imehesz.firebaseio.com/bookdata.json");
    
    var loadBooks = function() {
      var fromBook = M.Storage.get("settings").fromBook;
      console.log("MOOOOOOOOOOOOOO", fromBook);
      
      $.get(M.Storage.get("dataUrl") + "?lang=" + fromBook, function(data){
        M.Events.publish("books_loaded", data.books);
      });      
    }
    
    var router = function(bookId, chapterId) {
      console.log("ROUTER HEY!", bookId, chapterId);
      
      if (bookId && !chapterId) {
        M.Events.publish("book_changed", {bookId: bookId});
      }
      
      if (bookId && chapterId) {
        M.Events.publish("chapter_changed", {bookId: bookId, chapterId: chapterId});
      }
      
      if (!bookId && !chapterId) {
        loadBooks();
      }
    }
    
    M.Events.subscribe("settings_init", loadBooks);
    
    // Riot router
    riot.route(router);

    // Execute router function once for rendering the items
    riot.route.exec(router);
  </script>
</web-app>